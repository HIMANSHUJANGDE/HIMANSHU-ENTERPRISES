<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Passport Photo Print Preview with Rotate</title>
<style>
  body {
    font-family: sans-serif;
    padding: 10px;
  }

  #controls {
    margin-bottom: 20px;
  }

  input[type="number"] {
    width: 60px;
    margin-left: 5px;
  }

  #preview {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 20px;
  }

  .preview-item {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .preview-item img {
    max-width: 100px;
    max-height: 130px;
    border: 1px solid #000;
    object-fit: contain;
    margin-bottom: 5px;
    transition: transform 0.2s;
  }

  .page {
    width: 210mm;
    min-height: 297mm;
    display: flex;
    flex-wrap: wrap;
    gap: 2mm;
    padding: 5mm;
    box-sizing: border-box;
    background: #fff;
    page-break-after: always;
  }

  .photo {
    width: 35mm;
    height: 45mm;
    border: 1px solid #000;
    object-fit: contain;
    transform-origin: center center;
  }

  @media print {
    body * {
      visibility: hidden;
    }
    #pageContainer, #pageContainer * {
      visibility: visible;
    }
    #pageContainer {
      position: absolute;
      top: 0;
      left: 0;
    }
  }
</style>
</head>
<body>

<h1>Passport Photo Print Preview with Rotate</h1>

<div id="controls">
  <label>Upload Images:</label>
  <input type="file" id="images" multiple accept="image/*"><br><br>
  <div id="copiesInputs"></div>
  <button onclick="generatePages()">Generate Layout</button>
  <button onclick="window.print()">Print</button>
</div>

<h2>Preview:</h2>
<div id="preview"></div>

<div id="pageContainer"></div>

<script>
const imagesInput = document.getElementById('images');
const copiesInputs = document.getElementById('copiesInputs');
const previewDiv = document.getElementById('preview');

let imageData = []; // store image src and rotation

imagesInput.addEventListener('change', () => {
    copiesInputs.innerHTML = '';
    previewDiv.innerHTML = '';
    imageData = [];

    Array.from(imagesInput.files).forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = function(e) {
            // Save image src and initial rotation
            imageData.push({ src: e.target.result, rotation: 0 });

            // Preview image
            const previewItem = document.createElement('div');
            previewItem.className = 'preview-item';
            const img = document.createElement('img');
            img.src = e.target.result;
            img.dataset.index = index;

            // Rotate button
            const rotateBtn = document.createElement('button');
            rotateBtn.textContent = 'Rotate 90Â°';
            rotateBtn.onclick = () => {
                imageData[index].rotation += 90;
                img.style.transform = `rotate(${imageData[index].rotation}deg)`;
            };

            // Copies input
            const label = document.createElement('label');
            label.textContent = 'Copies: ';
            const input = document.createElement('input');
            input.type = 'number';
            input.min = 1;
            input.value = 1;
            input.dataset.index = index;

            previewItem.appendChild(img);
            previewItem.appendChild(rotateBtn);
            previewItem.appendChild(label);
            previewItem.appendChild(input);
            previewDiv.appendChild(previewItem);
        };
        reader.readAsDataURL(file);
    });
});

function generatePages() {
    const pageContainer = document.getElementById('pageContainer');
    pageContainer.innerHTML = '';

    const files = imageData;
    if (files.length === 0) {
        alert('Please upload at least one image.');
        return;
    }

    const copiesArray = Array.from(copiesInputs.querySelectorAll('input')).map(input => parseInt(input.value) || 1);

    let currentPage = createNewPage();
    pageContainer.appendChild(currentPage);
    let photosOnPage = 0;
    const maxPhotosPerRow = Math.floor((210 - 10) / 35);
    const maxRowsPerPage = Math.floor((297 - 10) / 45);
    const maxPhotosPerPage = maxPhotosPerRow * maxRowsPerPage;

    files.forEach((file, fileIndex) => {
        for (let i = 0; i < copiesArray[fileIndex]; i++) {
            const img = document.createElement('img');
            img.src = file.src;
            img.className = 'photo';
            img.style.transform = `rotate(${file.rotation}deg)`;

            if (photosOnPage >= maxPhotosPerPage) {
                currentPage = createNewPage();
                pageContainer.appendChild(currentPage);
                photosOnPage = 0;
            }

            currentPage.appendChild(img);
            photosOnPage++;
        }
    });
}

function createNewPage() {
    const page = document.createElement('div');
    page.className = 'page';
    return page;
}
</script>

</body>
</html>
